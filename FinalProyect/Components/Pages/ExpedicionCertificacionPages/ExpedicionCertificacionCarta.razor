@page "/certificacion/carta/{Id:int}"
@rendermode InteractiveServer

@using FinalProyect.Models
@using FinalProyect.Services

@inject ExpedicionCertificacionService CertService
@inject NavigationManager Nav
@inject IJSRuntime JS

<div class="container my-4">

    <div class="d-flex justify-content-between mb-3">
        <button class="btn btn-secondary" @onclick="Volver">
            <i class="fas fa-arrow-left"></i> Volver
        </button>

        <div>
            <button class="btn btn-primary me-2" @onclick="Imprimir">
                <i class="fas fa-print"></i> Imprimir
            </button>

            <button class="btn btn-warning" @onclick="DescargarPDF">
                <i class="fas fa-file-pdf"></i> Descargar PDF
            </button>
        </div>
    </div>

    @if (Modelo == null)
    {
        <div class="alert alert-danger">No se encontró la certificación.</div>
    }
    else
    {
        <div id="certificado" class="carta shadow p-5 bg-white">

            <h4 class="text-center fw-bold">ALCALDÍA MUNICIPAL DE VILLA RIVA</h4>
            <h6 class="text-center fw-bold">RNC 4300044199</h6>

            <h4 class="text-center mt-4 fw-bold text-decoration-underline">
                CERTIFICACIÓN DE ENTERRAMIENTO
            </h4>

            <p class="mt-4">
                Quien suscribe, <b>Lic. LUZ ATHANY UREÑA MERCEDES</b>, dominicana, mayor de edad,
                portadora de la cédula No. <b>01-1405540-3</b>,
                Tesorera Municipal de Villa Riva, Provincia Duarte, República Dominicana.
            </p>

            <h5 class="text-center mt-4 fw-bold">CERTIFICO Y DOY FE</h5>

            <p class="mt-3">
                Que en el cementerio de esta ciudad y municipio de Villa Riva se encuentran sepultados
                los restos de quien en vida se llamó <b>@Modelo.Contenido</b>.
            </p>

            <p>
                Certificación que se expide a solicitud de <b>@Modelo.NombreSolicitante</b>,
                portador(a) de la cédula <b>@Modelo.Cedula</b>.
            </p>

            <p class="mt-4">
                Dada en esta honorable Alcaldía Municipal de Villa Riva, Prov. Duarte,
                a los <b>@FechaTexto</b>.
            </p>

            <div class="text-center mt-5">
                <hr style="width: 250px; margin: auto;" />
                <p class="fw-bold mb-0">LIC. LUZ ATHANY UREÑA MERCEDES</p>
                <p class="mt-0">Tesorera Municipal</p>
            </div>

        </div>
    }
</div>

<style>
    .carta {
        width: 21cm;
        min-height: 27cm;
        margin: auto;
        font-size: 18px;
        line-height: 1.6;
    }

    @@media print {
        body * {
            visibility: hidden !important;
        }

        #certificado, #certificado * {
            visibility: visible !important;
        }

        #certificado {
            position: absolute;
            left: 0;
            top: 0;
        }
    }
</style>

@code {

    [Parameter] public int Id { get; set; }

    private ExpedicionCertificacion? Modelo;
    private string FechaTexto = "";

    protected override async Task OnInitializedAsync()
    {
        Modelo = await CertService.ObtenerPorId(Id);

        if (Modelo != null)
        {
            FechaTexto = $"{Modelo.FechaSolicitud:dd} días del mes " +
                          $"{Modelo.FechaSolicitud:MM} del año {Modelo.FechaSolicitud:yyyy}";
        }
    }

    private async Task Imprimir()
    {
        await JS.InvokeVoidAsync("printSection", "certificado");
    }

    private async Task DescargarPDF()
    {
        await JS.InvokeVoidAsync("print");
    }

    private void Volver()
    {
        Nav.NavigateTo("/certificacion");
    }
}